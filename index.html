<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Crynova</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #0072ff;
      --secondary: #ff2d9e;
      --accent: #7d3dff;
      --danger: #ff4757;
      --success: #26a17b;
      --warning: #ff9f00;
      --info: #2d87ff;
      --bg-light: #ffffff;
      --bg-lighter: #f8f9fa;
      --text-dark: #1a1a1a;
      --text-gray: #666;
      --text-light: #888;
      --border-light: rgba(0, 0, 0, 0.1);
      --shadow-light: rgba(0, 0, 0, 0.08);
    }

    body {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      color: var(--text-dark);
      min-height: 100vh;
      padding: 0;
      padding-top: 90px;
      padding-bottom: 90px;
      margin: 0;
    }

    .container {
      max-width: 100%;
      margin: 0;
      padding: 0;
      width: 100%;
    }

    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø«Ø§Ø¨Øª */
    .game-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      padding: 15px 20px;
      border-radius: 0;
      box-shadow: 0 4px 20px rgba(0, 114, 255, 0.3);
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      margin: 0;
      height: 90px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffffff, #f8f9fa);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      color: var(--primary);
      border: 3px solid rgba(255, 255, 255, 0.5);
    }

    .user-details h2 {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .user-details p {
      font-size: 12px;
      opacity: 0.9;
    }

    .user-username {
      font-size: 11px !important;
      color: rgba(255, 255, 255, 0.8) !important;
      margin-bottom: 2px !important;
      direction: ltr;
      text-align: left;
    }

    .points-display {
      text-align: center;
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 15px;
      border-radius: 30px;
      backdrop-filter: blur(5px);
    }

    .points-display .amount {
      font-size: 24px;
      font-weight: bold;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .points-display .label {
      font-size: 12px;
    }

    .daily-checkin-card {
      background: white;
      border-radius: 0;
      padding: 20px;
      margin-bottom: 0;
      box-shadow: 0 4px 20px var(--shadow-light);
      border: 1px solid rgba(0, 114, 255, 0.1);
      width: 100%;
      border-top: none;
      border-bottom: 1px solid rgba(0, 114, 255, 0.05);
      margin-top: 0;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .card-header h3 {
      font-size: 18px;
      color: var(--text-dark);
    }

    .streak-badge {
      background: linear-gradient(90deg, var(--warning), #ff6b00);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
    }

    .compact-calendar {
      text-align: center;
      margin-bottom: 20px;
    }

    .circle-calendar {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .calendar-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--bg-lighter);
      color: var(--text-light);
      border: 1px solid transparent;
    }

    .calendar-circle:hover {
      transform: scale(1.1);
      border-color: var(--primary);
    }

    .calendar-circle.checked {
      background: linear-gradient(135deg, var(--success), #1dd1a1);
      color: white;
    }

    .calendar-circle.today {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      animation: pulse 2s infinite;
      box-shadow: 0 0 0 2px rgba(0, 114, 255, 0.2);
    }

    .calendar-circle.future {
      background: var(--bg-lighter);
      color: var(--text-light);
      opacity: 0.7;
    }

    .calendar-circle.special {
      border: 1px solid var(--warning);
    }

    .circle-day {
      font-size: 12px;
    }

    .circle-check {
      display: none;
      font-size: 11px;
    }

    .calendar-circle.checked .circle-check {
      display: block;
    }

    .calendar-circle.checked .circle-day {
      display: none;
    }

    .circle-today {
      display: none;
      font-size: 11px;
      animation: bounce 1s infinite;
    }

    .calendar-circle.today .circle-today {
      display: block;
    }

    .calendar-circle.today .circle-day {
      display: none;
    }

    .circle-bonus {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--warning);
      color: white;
      font-size: 9px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .calendar-progress {
      margin-top: 15px;
    }

    .progress-bar {
      height: 6px;
      background: var(--bg-lighter);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 5px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 3px;
    }

    .progress-text {
      font-size: 12px;
      color: var(--text-light);
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0, 114, 255, 0.4); }
      70% { box-shadow: 0 0 0 5px rgba(0, 114, 255, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 114, 255, 0); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-2px); }
    }

    .checkin-button {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 16px rgba(0, 114, 255, 0.2);
    }

    .checkin-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 114, 255, 0.3);
    }

    .checkin-button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .checkin-button.checked {
      background: linear-gradient(90deg, var(--success), #1dd1a1);
    }

    .daily-tasks-card {
      background: white;
      border-radius: 0;
      padding: 20px;
      margin-bottom: 0;
      box-shadow: 0 4px 20px var(--shadow-light);
      border: 1px solid rgba(0, 114, 255, 0.1);
      width: 100%;
      border-top: none;
      border-bottom: 1px solid rgba(0, 114, 255, 0.05);
      margin-top: 0;
    }

    .tasks-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 15px;
    }

    .task-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 12px;
      background: var(--bg-lighter);
      border: 1px solid transparent;
      transition: all 0.3s ease;
    }

    .task-item:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .task-item.completed {
      background: rgba(38, 161, 123, 0.1);
      border-color: var(--success);
    }

    .task-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .task-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
    }

    .task-details h4 {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .task-details p {
      font-size: 12px;
      color: var(--text-light);
    }

    .task-reward {
      background: linear-gradient(90deg, var(--warning), #ff6b00);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .task-action {
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .task-action:hover {
      transform: scale(1.05);
    }

    .task-action.completed {
      background: var(--success);
    }

    .achievements-card {
      background: white;
      border-radius: 0;
      padding: 20px;
      margin-bottom: 0;
      box-shadow: 0 4px 20px var(--shadow-light);
      border: 1px solid rgba(0, 114, 255, 0.1);
      width: 100%;
      border-top: none;
      border-bottom: 1px solid rgba(0, 114, 255, 0.05);
      margin-top: 0;
    }

    /* === Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¹Ø§Ø¯Ø© ØªØµÙ…ÙŠÙ… Ù‚Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª === */
    .achievements-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 15px;
    }

    .achievement-item {
      display: flex;
      align-items: center;
      background: var(--bg-lighter);
      border-radius: 12px;
      padding: 12px 15px;
      transition: all 0.3s ease;
      width: 100%;
      border: 1px solid transparent;
      position: relative;
    }

    .achievement-item:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow-light);
    }

    .achievement-item.locked {
      opacity: 0.8;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    }

    .achievement-item.unlocked {
      background: linear-gradient(135deg, rgba(38, 161, 123, 0.1), rgba(29, 209, 161, 0.05));
      border-color: var(--success);
    }

    .achievement-icon {
      width: 45px;
      height: 45px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      flex-shrink: 0;
    }

    .achievement-item.locked .achievement-icon {
      background: linear-gradient(135deg, #cccccc, #999999);
    }

    .achievement-item.unlocked .achievement-icon {
      background: linear-gradient(135deg, var(--success), #1dd1a1);
    }

    .achievement-details {
      flex: 1;
      margin-right: 15px;
      margin-left: 15px;
    }

    .achievement-details h4 {
      font-size: 14px;
      margin-bottom: 4px;
      color: var(--text-dark);
    }

    .achievement-details p {
      font-size: 11px;
      color: var(--text-light);
      line-height: 1.4;
      margin-bottom: 5px;
    }

    .achievement-reward {
      font-size: 11px;
      font-weight: bold;
      color: var(--warning);
      background: rgba(255, 159, 0, 0.1);
      padding: 3px 8px;
      border-radius: 10px;
      display: inline-block;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .achievement-item.unlocked .achievement-reward {
      background: rgba(38, 161, 123, 0.2);
      color: var(--success);
    }

    .achievement-status {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
      margin-right: 5px;
    }

    .achievement-status.locked {
      background: rgba(255, 71, 87, 0.1);
      color: var(--danger);
      border: 1px solid rgba(255, 71, 87, 0.2);
    }

    .achievement-status.unlocked {
      background: rgba(38, 161, 123, 0.1);
      color: var(--success);
      border: 1px solid rgba(38, 161, 123, 0.2);
      animation: pulse 2s infinite;
    }
    /* === Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¹Ø§Ø¯Ø© ØªØµÙ…ÙŠÙ… Ù‚Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª === */

    .leaderboard-card {
      background: white;
      border-radius: 0;
      padding: 20px;
      margin-bottom: 0;
      box-shadow: 0 4px 20px var(--shadow-light);
      border: 1px solid rgba(0, 114, 255, 0.1);
      width: 100%;
      border-top: none;
      border-bottom: 1px solid rgba(0, 114, 255, 0.05);
      margin-top: 0;
    }

    .leaderboard-tabs {
      display: flex;
      margin-bottom: 15px;
      background: var(--bg-lighter);
      border-radius: 12px;
      padding: 4px;
    }

    .leaderboard-tab {
      flex: 1;
      text-align: center;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .leaderboard-tab.active {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
    }

    .leaderboard-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 12px;
      background: var(--bg-lighter);
    }

    .leaderboard-item.me {
      background: rgba(0, 114, 255, 0.1);
      border: 1px solid rgba(0, 114, 255, 0.2);
    }

    .leaderboard-rank {
      font-weight: bold;
      font-size: 18px;
      width: 30px;
      text-align: center;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .leaderboard-rank.top-1 { color: gold; }
    .leaderboard-rank.top-2 { color: silver; }
    .leaderboard-rank.top-3 { color: #cd7f32; }

    .leaderboard-user {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .leaderboard-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .leaderboard-name {
      font-weight: bold;
    }

    .leaderboard-points {
      font-weight: bold;
      color: var(--primary);
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .gifts-card,
    .challenges-card,
    .groups-card,
    .referrals-card,
    .shop-card,
    .advanced-referral-card {
      background: white;
      border-radius: 0;
      padding: 20px;
      margin-bottom: 0;
      box-shadow: 0 4px 20px var(--shadow-light);
      border: 1px solid rgba(0, 114, 255, 0.1);
      width: 100%;
      border-top: none;
      border-bottom: 1px solid rgba(0, 114, 255, 0.05);
      margin-top: 0;
    }

    .gift-item, .challenge-item, .group-item, .shop-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 12px;
      background: var(--bg-lighter);
      margin-bottom: 10px;
      border: 1px solid transparent;
      transition: all 0.3s ease;
    }

    .gift-item:hover, .challenge-item:hover, .group-item:hover, .shop-item:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .gift-info, .challenge-info, .group-info, .shop-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .gift-icon, .challenge-icon, .group-icon, .shop-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
    }

    .gift-details h4, .challenge-details h4, .group-details h4, .shop-details h4 {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .gift-details p, .challenge-details p, .group-details p, .shop-details p {
      font-size: 12px;
      color: var(--text-light);
    }

    .gift-action, .challenge-action, .group-action, .shop-action {
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
      min-width: 110px;
      text-align: center;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .gift-action:hover, .challenge-action:hover, .group-action:hover, .shop-action:hover {
      transform: scale(1.05);
    }

    .referral-link {
      background: var(--bg-lighter);
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .referral-link input {
      flex: 1;
      border: none;
      background: transparent;
      padding: 8px;
      font-size: 14px;
      color: var(--text-dark);
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .referral-link button {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .referral-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .referral-stat {
      background: var(--bg-lighter);
      padding: 12px;
      border-radius: 12px;
      text-align: center;
    }

    .referral-stat .value {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .referral-stat .label {
      font-size: 12px;
      color: var(--text-light);
    }

    .advanced-referral-card h3 {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--primary);
    }

    .referral-link-container {
      background: linear-gradient(135deg, rgba(0, 114, 255, 0.05), rgba(125, 61, 255, 0.05));
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      border: 1px solid rgba(0, 114, 255, 0.1);
    }

    .referral-link-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .referral-link-title {
      font-weight: bold;
      font-size: 14px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .referral-link-value {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 5px;
      word-break: break-all;
      padding: 8px;
      background: var(--bg-lighter);
      border-radius: 8px;
      direction: ltr;
      text-align: left;
      font-family: 'Arial', sans-serif;
    }

    .copy-referral-btn {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .referral-info-text {
      font-size: 12px;
      color: var(--text-light);
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 10px;
    }

    .referral-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .referral-stat-card {
      background: var(--bg-lighter);
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .referral-stat-value {
      font-size: 20px;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 5px;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .referral-stat-label {
      font-size: 11px;
      color: var(--text-light);
    }

    .referral-rewards-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .referral-reward-card {
      background: var(--bg-lighter);
      padding: 15px;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .reward-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .reward-title {
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
    }

    .reward-badge {
      font-size: 12px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      padding: 4px 8px;
      border-radius: 20px;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .reward-description {
      font-size: 12px;
      color: var(--text-light);
      line-height: 1.5;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--border-light);
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
      z-index: 1000;
      max-width: 100%;
      margin: 0;
      display: flex;
      padding: 12px 0;
      justify-content: space-around;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text-light);
      text-decoration: none;
      font-size: 11px;
    }

    .nav-item.active {
      color: var(--primary);
    }

    .nav-item i {
      font-size: 18px;
    }

    .nav-item span {
      font-size: 10px;
      font-weight: 500;
    }

    .nav-item:hover {
      transform: translateY(-2px);
    }

    .floating-message {
      position: fixed;
      top: 80px;
      right: 50%;
      transform: translateX(50%);
      background: linear-gradient(90deg, var(--success), #1dd1a1);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      z-index: 1001;
      animation: slideDown 0.5s ease, fadeOut 0.5s ease 2s forwards;
      max-width: 300px;
      text-align: center;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    @keyframes slideDown {
      from {
        top: -100px;
        opacity: 0;
      }
      to {
        top: 80px;
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    .points-animation {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
      animation: floatUp 1s ease forwards;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateY(-50px);
      }
    }

    .section-hidden {
      display: none;
    }

    .english-numbers {
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .loading-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      display: none;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .loading-text {
      color: white;
      font-size: 18px;
      font-weight: bold;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .firebase-status {
      position: fixed;
      top: 80px;
      right: 10px;
      padding: 8px 15px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1002;
      display: none;
      animation: slideDown 0.5s ease;
    }
    
    .firebase-status.success {
      background: var(--success);
      color: white;
    }
    
    .firebase-status.error {
      background: var(--danger);
      color: white;
    }
    
    .firebase-status.warning {
      background: var(--warning);
      color: white;
    }
    
    .user-search-result {
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      font-size: 12px;
      display: none;
    }
    
    .user-search-result.found {
      background: rgba(38, 161, 123, 0.1);
      border: 1px solid var(--success);
    }
    
    .user-search-result.not-found {
      background: rgba(255, 71, 87, 0.1);
      border: 1px solid var(--danger);
    }

    .quick-load {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-right: 5px;
    }

    .tg-adjust {
      padding-top: env(safe-area-inset-top, 20px);
    }
    
    .telegram-theme-dark {
      background: #1a1a1a;
      color: #ffffff;
    }
    
    .telegram-theme-dark .game-header {
      background: linear-gradient(90deg, #2d87ff, #7d3dff);
    }
    
    .telegram-theme-dark .daily-checkin-card,
    .telegram-theme-dark .daily-tasks-card,
    .telegram-theme-dark .achievements-card,
    .telegram-theme-dark .leaderboard-card,
    .telegram-theme-dark .gifts-card,
    .telegram-theme-dark .challenges-card,
    .telegram-theme-dark .groups-card,
    .telegram-theme-dark .referrals-card,
    .telegram-theme-dark .shop-card,
    .telegram-theme-dark .advanced-referral-card {
      background: #2d2d2d;
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.1);
      border-radius: 0;
    }
    
    .telegram-theme-dark .task-item,
    .telegram-theme-dark .achievement-item,
    .telegram-theme-dark .leaderboard-item,
    .telegram-theme-dark .gift-item,
    .telegram-theme-dark .challenge-item,
    .telegram-theme-dark .group-item,
    .telegram-theme-dark .shop-item {
      background: #3d3d3d;
      color: #ffffff;
    }
    
    .telegram-theme-dark .referral-link,
    .telegram-theme-dark .referral-stat,
    .telegram-theme-dark .referral-link-container,
    .telegram-theme-dark .referral-link-value,
    .telegram-theme-dark .referral-stat-card,
    .telegram-theme-dark .referral-reward-card {
      background: #3d3d3d;
      color: #ffffff;
    }
    
    .telegram-theme-dark .progress-bar {
      background: #3d3d3d;
    }
    
    .telegram-theme-dark .bottom-nav {
      background: #2d2d2d;
      border-top-color: rgba(255, 255, 255, 0.1);
    }
    
    .telegram-theme-dark .checkin-button:disabled {
      background: #555555;
    }
    
    /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª === */
    .telegram-theme-dark .achievement-item.locked {
      background: #3d3d3d;
      opacity: 0.7;
    }
    
    .telegram-theme-dark .achievement-item.unlocked {
      background: rgba(38, 161, 123, 0.15);
    }
    
    .telegram-theme-dark .achievement-status.locked {
      background: rgba(255, 71, 87, 0.2);
    }
    
    .telegram-theme-dark .achievement-status.unlocked {
      background: rgba(38, 161, 123, 0.2);
    }
    
    /* === Ø¨Ø¯Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© === */
    .groups-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    @media (min-width: 768px) {
      .groups-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .group-card {
      background: var(--bg-lighter);
      border-radius: 12px;
      padding: 15px;
      border: 1px solid transparent;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      height: fit-content;
    }

    .group-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px var(--shadow-light);
      border-color: var(--primary);
    }

    .group-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    }

    .group-name {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .group-name i {
      color: var(--primary);
    }

    .group-rank {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: bold;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
    }

    .group-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .stat-item {
      text-align: center;
      padding: 8px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 8px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: var(--primary);
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-light);
    }

    .group-range {
      font-size: 12px;
      color: var(--text-light);
      text-align: center;
      margin: 10px 0;
      padding: 5px;
      background: rgba(0, 0, 0, 0.03);
      border-radius: 6px;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .group-members {
      margin-top: 15px;
    }

    .members-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .members-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 250px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .member-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 8px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
    }

    .member-item:hover {
      background: rgba(0, 114, 255, 0.05);
      transform: translateX(-2px);
    }

    .member-item.me {
      background: rgba(0, 114, 255, 0.1);
      border-color: rgba(0, 114, 255, 0.2);
      position: relative;
    }

    .member-info {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .member-position {
      font-weight: bold;
      color: var(--text-dark);
      font-size: 12px;
      width: 32px;
      text-align: center;
      font-family: 'Arial', sans-serif;
      direction: ltr;
    }

    .member-position.core {
      color: #d4af37;
      background: rgba(212, 175, 55, 0.1);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .member-position.elite {
      color: #c0c0c0;
      background: rgba(192, 192, 192, 0.1);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .member-position.officer {
      color: #cd7f32;
      background: rgba(205, 127, 50, 0.1);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .member-position.veteran {
      color: var(--primary);
      background: rgba(0, 114, 255, 0.1);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .member-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 12px;
    }

    .member-details {
      flex: 1;
    }

    .member-name {
      font-size: 13px;
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .member-title {
      font-size: 11px;
      color: var(--text-light);
      font-weight: 500;
    }

    .member-points {
      font-weight: bold;
      color: var(--primary);
      font-size: 13px;
      font-family: 'Arial', sans-serif;
      direction: ltr;
      min-width: 60px;
      text-align: left;
    }

    .group-status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-size: 13px;
      font-weight: bold;
    }

    .group-status.empty {
      background: rgba(255, 71, 87, 0.1);
      color: var(--danger);
      border: 1px solid rgba(255, 71, 87, 0.2);
    }

    .group-status.active {
      background: rgba(38, 161, 123, 0.1);
      color: var(--success);
      border: 1px solid rgba(38, 161, 123, 0.2);
    }

    .group-status.full {
      background: rgba(255, 159, 0, 0.1);
      color: var(--warning);
      border: 1px solid rgba(255, 159, 0, 0.2);
    }

    .members-scroll {
      max-height: 250px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .members-scroll::-webkit-scrollbar {
      width: 4px;
    }

    .members-scroll::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 2px;
    }

    .members-scroll::-webkit-scrollbar-thumb {
      background: rgba(0, 114, 255, 0.3);
      border-radius: 2px;
    }

    .telegram-theme-dark .group-card {
      background: #3d3d3d;
      border-color: rgba(255, 255, 255, 0.1);
    }

    .telegram-theme-dark .member-item {
      background: #4d4d4d;
      border-color: rgba(255, 255, 255, 0.05);
    }

    .telegram-theme-dark .member-item.me {
      background: rgba(0, 114, 255, 0.2);
    }

    .telegram-theme-dark .group-card-header {
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .telegram-theme-dark .stat-item {
      background: #4d4d4d;
    }
    /* === Ù†Ù‡Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© === */

    @media (max-width: 480px) {
      body {
        padding: 0;
        padding-top: 85px;
        padding-bottom: 80px;
      }
      
      .game-header {
        height: 85px;
        padding: 12px 15px;
      }
      
      .daily-checkin-card,
      .daily-tasks-card,
      .achievements-card,
      .leaderboard-card,
      .gifts-card,
      .challenges-card,
      .groups-card,
      .referrals-card,
      .shop-card,
      .advanced-referral-card {
        padding: 15px;
        margin-bottom: 0;
      }
      
      .bottom-nav {
        padding: 10px 0;
      }
      
      .floating-message,
      .firebase-status {
        top: 75px;
      }
      
      /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª */
      .achievement-item {
        padding: 10px 12px;
      }
      
      .achievement-icon {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      
      .achievement-details h4 {
        font-size: 13px;
      }
      
      .achievement-details p {
        font-size: 10px;
      }
      
      .achievement-status {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }

      /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª */
      .group-card {
        padding: 12px;
      }
      
      .group-name {
        font-size: 15px;
      }
      
      .member-name {
        font-size: 12px;
      }
      
      .member-title {
        font-size: 10px;
      }
      
      .member-points {
        font-size: 12px;
        min-width: 55px;
      }
    }
  </style>
</head>
<body>
  <div id="firebaseStatus" class="firebase-status"></div>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø«Ø§Ø¨Øª -->
  <div class="game-header">
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">
        <div class="quick-load" style="display: none;"></div>
        <span id="avatarText">Ù…</span>
      </div>
      <div class="user-details">
        <h2 id="userName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
        <div id="userUsername" class="user-username" style="display: none;"></div>
        <p>Ù…Ø³ØªÙˆÙ‰: <span id="userLevel" class="english-numbers">-</span></p>
      </div>
    </div>
    <div class="points-display">
      <div class="amount" id="totalPoints">0</div>
      <div class="label">Ù†Ù‚Ø·Ø©</div>
    </div>
  </div>

  <div id="gameContainer" class="container">
    <div id="sectionHome">
      <div class="daily-checkin-card">
        <div class="card-header">
          <h3><i class="fas fa-calendar-check"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
          <div class="streak-badge" id="streakBadge">ğŸ”¥ <span class="english-numbers">0</span> Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©</div>
        </div>
        
        <div class="compact-calendar">
          <div class="circle-calendar" id="calendarCircles"></div>
          
          <div class="calendar-progress">
            <div class="progress-bar">
              <div class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text"><span class="english-numbers">0</span>/7 Ø£ÙŠØ§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
          </div>
        </div>
        
        <button class="checkin-button" id="checkinButton">
          <i class="fas fa-check-circle"></i>
          <span>Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…</span>
        </button>
      </div>

      <div class="daily-tasks-card">
        <h3><i class="fas fa-tasks"></i> Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
        <div class="tasks-list" id="tasksList">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...
          </div>
        </div>
      </div>

      <div class="achievements-card">
        <h3><i class="fas fa-trophy"></i> Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h3>
        <div class="achievements-grid" id="achievementsGrid">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª...
          </div>
        </div>
      </div>

      <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© Ù…Ù† Ù‡Ù†Ø§ -->
    </div>

    <div class="section-hidden" id="sectionFriends">
      <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ù‡Ù†Ø§ -->

      <div class="gifts-card">
        <h3><i class="fas fa-gift"></i> Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
        <div class="gifts-list" id="giftsList">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§...
          </div>
        </div>
      </div>

      <div class="advanced-referral-card" id="advancedReferralCard">
        <h3><i class="fas fa-user-plus"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h3>
        
        <div class="referral-link-container">
          <div class="referral-link-header">
            <div class="referral-link-title">
              <span>Ø±Ø§Ø¨Ø· Ø¯Ø¹ÙˆØªÙƒ Ø§Ù„Ø®Ø§Øµ</span>
              <span style="margin-right: 10px; color: var(--success); font-weight: bold; font-size: 12px;">
                <i class="fas fa-coins"></i> +100 Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ ØµØ¯ÙŠÙ‚
              </span>
            </div>
            <button class="copy-referral-btn" id="copyFriendReferralLink">
              <i class="fas fa-copy"></i> Ù†Ø³Ø®
            </button>
          </div>
          <div class="referral-link-value" id="friendReferralLink">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
          </div>
          <div class="referral-info-text">
            <i class="fas fa-info-circle"></i> Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ 100 Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ ØµØ¯ÙŠÙ‚ ÙŠØ¯Ø®Ù„ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø·Ùƒ!
          </div>
        </div>
        
        <div class="referral-stats-grid">
          <div class="referral-stat-card">
            <div class="referral-stat-value" id="totalFriendReferrals">0</div>
            <div class="referral-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙØ­Ø§Ù„ÙŠÙ†</div>
          </div>
          <div class="referral-stat-card">
            <div class="referral-stat-value" id="referralEarnings">0</div>
            <div class="referral-stat-label">Ù†Ù‚Ø§Ø· Ù…ÙƒØªØ³Ø¨Ø©</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-hidden" id="sectionChallenges">
      <div class="challenges-card">
        <h3><i class="fas fa-bolt"></i> Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        <div class="challenges-list" id="challengesList">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª...
          </div>
        </div>
      </div>
      
      <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ§Øª Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ù‡Ù†Ø§ -->
      
      <!-- ØªÙ… Ù†Ù‚Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© Ø¥Ù„Ù‰ Ù‡Ù†Ø§ (Ø£Ø³ÙÙ„ ØªØ­Ø¯ÙŠØ§Øª Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡) -->
      <div class="leaderboard-card">
        <h3><i class="fas fa-crown"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h3>
        <div class="leaderboard-tabs">
          <div class="leaderboard-tab active" data-period="daily">Ø§Ù„ÙŠÙˆÙ…</div>
          <div class="leaderboard-tab" data-period="weekly">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
          <div class="leaderboard-tab" data-period="all">Ø§Ù„ÙƒÙ„</div>
        </div>
        <div class="leaderboard-list" id="leaderboardList">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµØ¯Ø§Ø±Ø©...
          </div>
        </div>
      </div>
    </div>

    <!-- === Ø¨Ø¯Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„ === -->
    <div class="section-hidden" id="sectionGroups">
      <div class="groups-card">
        <h3><i class="fas fa-users"></i> Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø¹ØµØ§Ø¨Ø§Øª</h3>
        
        <div class="groups-container" id="groupsContainer">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª...
          </div>
        </div>
        
        <!-- ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
      </div>
    </div>
    <!-- === Ù†Ù‡Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„ === -->

    <div class="section-hidden" id="sectionReferrals">
      <div class="referrals-card">
        <h3><i class="fas fa-user-plus"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</h3>
        <div class="referral-link">
          <input type="text" id="referralLink" value="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..." readonly>
          <button id="copyReferralLink">
            <i class="fas fa-copy"></i> Ù†Ø³Ø®
          </button>
        </div>
        <div class="referral-stats">
          <div class="referral-stat">
            <div class="value" id="totalReferrals">0</div>
            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
          </div>
          <div class="referral-stat">
            <div class="value" id="activeReferrals">0</div>
            <div class="label">Ø¥Ø­Ø§Ù„Ø§Øª Ù†Ø´Ø·Ø©</div>
          </div>
          <div class="referral-stat">
            <div class="value" id="referralPoints">0</div>
            <div class="label">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</div>
          </div>
          <div class="referral-stat">
            <div class="value" id="referralRewards">0</div>
            <div class="label">Ù…ÙƒØ§ÙØ¢Øª Ù…Ø³ØªØ­Ù‚Ø©</div>
          </div>
        </div>
        <h4 style="margin: 15px 0 10px 0;"><i class="fas fa-award"></i> Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h4>
        <div class="referral-rewards" id="referralRewardsList">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø©...
          </div>
        </div>
      </div>
    </div>

    <div class="section-hidden" id="sectionShop">
      <div class="shop-card">
        <h3><i class="fas fa-store"></i> Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</h3>
        <div class="shop-tabs" style="display: flex; margin-bottom: 15px; background: var(--bg-lighter); border-radius: 12px; padding: 4px;">
          <div class="leaderboard-tab active" data-category="all">Ø§Ù„ÙƒÙ„</div>
          <div class="leaderboard-tab" data-category="digital">Ø±Ù‚Ù…ÙŠ</div>
          <div class="leaderboard-tab" data-category="physical">Ù…Ù„Ù…ÙˆØ³</div>
          <div class="leaderboard-tab" data-category="discounts">Ø®ØµÙˆÙ…Ø§Øª</div>
        </div>
        <div class="shop-items" id="shopItems">
          <div style="text-align: center; padding: 20px; color: var(--text-light)">
            <div class="quick-load"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø±...
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <div class="nav-item active" id="navHome">
      <i class="fas fa-home"></i>
      <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    <div class="nav-item" id="navFriends">
      <i class="fas fa-user-friends"></i>
      <span>Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</span>
    </div>
    <div class="nav-item" id="navChallenges">
      <i class="fas fa-bolt"></i>
      <span>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</span>
    </div>
    <div class="nav-item" id="navGroups">
      <i class="fas fa-users"></i>
      <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
    </div>
    <div class="nav-item" id="navShop">
      <i class="fas fa-store"></i>
      <span>Ø§Ù„Ù…ØªØ¬Ø±</span>
    </div>
  </div>

  <div id="floatingMessage" class="floating-message" style="display: none;"></div>

  <script>
    // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
    const firebaseConfig = {
      apiKey: "AIzaSyBX8v0qIVjG-Z46fVDeEUDKcPxa_FQF9Qc",
      authDomain: "bnak-belaiba.firebaseapp.com",
      projectId: "bnak-belaiba",
      storageBucket: "bnak-belaiba.firebasestorage.app",
      messagingSenderId: "286736432059",
      appId: "1:286736432059:web:ec1ed4292850f00008229e",
      databaseURL: "https://bnak-belaiba-default-rtdb.firebaseio.com/"
    };

    let firebaseApp, auth, database, db;
    try {
      firebaseApp = firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      database = firebase.database();
      db = firebase.firestore();
      console.log('âœ… Firebase ØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­');
      updateFirebaseStatus('success', 'âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
      updateFirebaseStatus('error', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
    }

    // ========== Telegram WebApp Ù…ØªØºÙŠØ±Ø§Øª ==========
    let tg = null;
    let isTelegramWebApp = false;
    let telegramUser = null;

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
    function updateFirebaseStatus(type, message) {
      const statusElement = document.getElementById('firebaseStatus');
      if (statusElement) {
        statusElement.textContent = message;
        statusElement.className = 'firebase-status';
        
        if (type === 'error') {
          statusElement.classList.add('error');
        } else if (type === 'warning') {
          statusElement.classList.add('warning');
        } else if (type === 'success') {
          statusElement.classList.add('success');
        }
        
        statusElement.style.display = 'block';
        
        setTimeout(() => {
          statusElement.style.display = 'none';
        }, 5000);
      }
    }

    function showMessage(text) {
      const messageEl = document.getElementById('floatingMessage');
      messageEl.textContent = text;
      messageEl.style.display = 'block';
      
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 2500);
    }

    function animatePoints(points) {
      const pointsEl = document.createElement('div');
      pointsEl.className = 'points-animation';
      pointsEl.textContent = `+${points.toLocaleString('en-US')} Ù†Ù‚Ø·Ø©`;
      pointsEl.style.position = 'fixed';
      pointsEl.style.top = '50%';
      pointsEl.style.left = '50%';
      pointsEl.style.transform = 'translate(-50%, -50%)';
      pointsEl.style.color = 'var(--success)';
      pointsEl.style.fontWeight = 'bold';
      pointsEl.style.fontSize = '24px';
      pointsEl.style.zIndex = '1000';
      pointsEl.style.pointerEvents = 'none';
      
      document.body.appendChild(pointsEl);
      
      setTimeout(() => {
        document.body.removeChild(pointsEl);
      }, 1000);
    }

    function showQuickLoading(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        const quickLoad = element.querySelector('.quick-load');
        if (quickLoad) quickLoad.style.display = 'inline-block';
      }
    }

    function hideQuickLoading(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        const quickLoad = element.querySelector('.quick-load');
        if (quickLoad) quickLoad.style.display = 'none';
      }
    }

    // ========== Ø¥Ø¹Ø¯Ø§Ø¯ Telegram WebApp ==========
    function initializeTelegramWebApp() {
      try {
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
          tg = Telegram.WebApp;
          isTelegramWebApp = true;
          
          console.log('âœ… Telegram WebApp ØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡');
          
          // ØªÙˆØ³ÙŠØ¹ Ù†Ø§ÙØ°Ø© WebApp
          tg.expand();
          
          // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ù…Ø© Telegram
          if (tg.colorScheme === 'dark') {
            document.body.classList.add('telegram-theme-dark');
          }
          
          // Ø¶Ø¨Ø· Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©
          tg.setBackgroundColor('#f8f9fa');
          
          // ØªÙ…ÙƒÙŠÙ† Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
          tg.enableClosingConfirmation();
          
          // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          telegramUser = tg.initDataUnsafe?.user;
          
          if (telegramUser) {
            console.log('ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Telegram:', telegramUser);
            return telegramUser;
          } else {
            console.log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Telegram WebApp');
            return null;
          }
        } else {
          console.log('âš ï¸ Telegram WebApp ØºÙŠØ± Ù…ØªÙˆÙØ±');
          return null;
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Telegram WebApp:', error);
        return null;
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
    async function registerUserIfNeeded(userData) {
      try {
        if (!db) {
          console.warn('âš ï¸ Firestore ØºÙŠØ± Ù…ØªØµÙ„ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·');
          return null;
        }
        
        const userId = userData.id.toString();
        const usersRef = db.collection('users').doc(userId);
        
        const userDoc = await usersRef.get();
        
        if (!userDoc.exists) {
          const newUserData = {
            telegramId: userId,
            firstName: userData.first_name || userData.firstName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
            username: userData.username || null,
            totalPoints: 100,
            currentStreak: 0,
            referrals: 0,
            referralPoints: 0
          };
          
          await usersRef.set(newUserData);
          console.log('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', userId);
          
          return newUserData;
        } else {
          const existingUser = userDoc.data();
          console.log('ğŸ‘¤ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯:', userId);
          return existingUser;
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        throw error;
      }
    }

    async function updateUserPoints(userId, pointsChange, reason) {
      try {
        if (!db) return false;
        
        const userRef = db.collection('users').doc(userId);
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const userDoc = await userRef.get();
        if (!userDoc.exists) {
          console.error('âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          return false;
        }
        
        const userData = userDoc.data();
        const currentPoints = userData.totalPoints || 0;
        const newPoints = currentPoints + pointsChange;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙ‚Ø·
        await userRef.update({
          totalPoints: newPoints
        });
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·
        await db.collection('pointsHistory').add({
          userId: userId,
          pointsChange: pointsChange,
          pointsAfter: newPoints,
          reason: reason,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}: ${currentPoints} â†’ ${newPoints} (${reason})`);
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·:', error);
        return false;
      }
    }

    async function updateUserStreak(userId, newStreak, lastCheckinDate) {
      try {
        if (!db) return false;
        
        const userRef = db.collection('users').doc(userId);
        
        await userRef.update({
          currentStreak: newStreak
        });
        
        console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØªØ§Ø¨Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}: ${newStreak} Ø£ÙŠØ§Ù…`);
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØªØ§Ø¨Ø¹:', error);
        return false;
      }
    }

    async function addReferralToDatabase(referrerId, referredId) {
      try {
        if (!db) return false;
        
        const referralRef = db.collection('referrals').doc();
        const referralDate = new Date().toISOString().split('T')[0];
        const pointsAwarded = 100;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
        await referralRef.set({
          referrerId: referrerId,
          referredId: referredId,
          referralDate: referralDate,
          pointsAwarded: pointsAwarded,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØ­ÙŠÙ„
        const referrerRef = db.collection('users').doc(referrerId);
        await referrerRef.update({
          referrals: firebase.firestore.FieldValue.increment(1),
          referralPoints: firebase.firestore.FieldValue.increment(pointsAwarded),
          totalPoints: firebase.firestore.FieldValue.increment(pointsAwarded)
        });
        
        // ØªØ³Ø¬ÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·
        await db.collection('pointsHistory').add({
          userId: referrerId,
          pointsChange: pointsAwarded,
          reason: 'Ù…ÙƒØ§ÙØ£Ø© Ø¥Ø­Ø§Ù„Ø©',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø­Ø§Ù„Ø© Ù…Ù† ${referrerId} Ø¥Ù„Ù‰ ${referredId}`);
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©:', error);
        return false;
      }
    }

    async function getUserStatsFromDatabase(userId) {
      try {
        if (!db) return null;
        
        const userRef = db.collection('users').doc(userId);
        const userDoc = await userRef.get();
        
        if (!userDoc.exists) {
          return null;
        }
        
        const userData = userDoc.data();
        
        // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª
        const referralsSnapshot = await db.collection('referrals')
          .where('referrerId', '==', userId)
          .get();
        
        return {
          totalPoints: userData.totalPoints || 0,
          currentStreak: userData.currentStreak || 0,
          referrals: referralsSnapshot.size || 0,
          referralPoints: userData.referralPoints || 0
        };
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        return null;
      }
    }

    async function getLeaderboardFromDatabase() {
      try {
        if (!db) return [];
        
        const usersSnapshot = await db.collection('users')
          .orderBy('totalPoints', 'desc')
          .limit(50)
          .get();
        
        const leaderboard = [];
        usersSnapshot.forEach(doc => {
          const user = doc.data();
          leaderboard.push({
            id: doc.id,
            name: user.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…',
            points: user.totalPoints || 0,
            avatar: (user.firstName || 'Ù…').charAt(0),
            level: calculateLevel(user.totalPoints || 0)
          });
        });
        
        return leaderboard;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©:', error);
        return [];
      }
    }

    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ==========
    const groupRanks = [
      // Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ (Core Management)
      "Supreme Leader",           // 1
      "Deputy Leader",            // 2
      "Chief Strategist",         // 3
      
      // Ø§Ù„Ù†Ø®Ø¨Ø© (Elite Unit)
      "Warlord",                  // 4
      "Enforcer Alpha",           // 5
      "Enforcer Beta",            // 6
      "Enforcer Gamma",           // 7
      "Shadow Captain",           // 8
      "Intel Master",             // 9
      "Treasurer",                // 10
      
      // Ø§Ù„Ø¶Ø¨Ø§Ø· (Officers)
      "Officer I",                // 11
      "Officer II",               // 12
      "Officer III",              // 13
      "Officer IV",               // 14
      "Officer V",                // 15
      
      // Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ÙˆÙ† Ø§Ù„Ù…Ø­ØªØ±ÙÙˆÙ† (Veterans)
      "Veteran 16",               // 16
      "Veteran 17",               // 17
      "Veteran 18",               // 18
      "Veteran 19",               // 19
      "Veteran 20",               // 20
      "Veteran 21",               // 21
      "Veteran 22",               // 22
      "Veteran 23",               // 23
      "Veteran 24",               // 24
      "Veteran 25",               // 25
      "Veteran 26",               // 26
      "Veteran 27",               // 27
      "Veteran 28",               // 28
      "Veteran 29",               // 29
      "Veteran 30",               // 30
      "Veteran 31",               // 31
      "Veteran 32",               // 32
      "Veteran 33",               // 33
      "Veteran 34",               // 34
      "Veteran 35",               // 35
      "Veteran 36",               // 36
      "Veteran 37",               // 37
      "Veteran 38",               // 38
      "Veteran 39",               // 39
      "Veteran 40",               // 40
      "Veteran 41",               // 41
      "Veteran 42",               // 42
      "Veteran 43",               // 43
      "Veteran 44",               // 44
      "Veteran 45",               // 45
      "Veteran 46",               // 46
      "Veteran 47",               // 47
      "Veteran 48",               // 48
      "Veteran 49",               // 49
      "Veteran 50"                // 50
    ];

    // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ==========
    const predefinedGroups = [
      {
        id: 1,
        name: "Black Hand",
        icon: "fas fa-fist-raised",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© - Ø£ÙˆÙ„ 50 Ù„Ø§Ø¹Ø¨",
        color: "#1a1a1a",
        rankRange: "1-50"
      },
      {
        id: 2,
        name: "Bratva",
        icon: "fas fa-crown",
        capacity: 50,
        members: [],
        description: "Ø§Ù„ØµÙÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© - Ø§Ù„Ù…Ø±ÙƒØ² 51 Ø¥Ù„Ù‰ 100",
        color: "#cc0000",
        rankRange: "51-100"
      },
      {
        id: 3,
        name: "Cartel",
        icon: "fas fa-skull-crossbones",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„Ù…Ø±ÙƒØ² 101 Ø¥Ù„Ù‰ 150",
        color: "#00aa00",
        rankRange: "101-150"
      },
      {
        id: 4,
        name: "Iron Wolves",
        icon: "fas fa-wolf-pack-battalion",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹ - Ø§Ù„Ù…Ø±ÙƒØ² 151 Ø¥Ù„Ù‰ 200",
        color: "#666666",
        rankRange: "151-200"
      },
      {
        id: 5,
        name: "Mafia",
        icon: "fas fa-user-secret",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù…Ø³ - Ø§Ù„Ù…Ø±ÙƒØ² 201 Ø¥Ù„Ù‰ 250",
        color: "#8b4513",
        rankRange: "201-250"
      },
      {
        id: 6,
        name: "Red Dragons",
        icon: "fas fa-dragon",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¯Ø³ - Ø§Ù„Ù…Ø±ÙƒØ² 251 Ø¥Ù„Ù‰ 300",
        color: "#ff0000",
        rankRange: "251-300"
      },
      {
        id: 7,
        name: "Shadow Syndicate",
        icon: "fas fa-mask",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ø¹ - Ø§Ù„Ù…Ø±ÙƒØ² 301 Ø¥Ù„Ù‰ 350",
        color: "#333333",
        rankRange: "301-350"
      },
      {
        id: 8,
        name: "Sicilian Order",
        icon: "fas fa-shield-alt",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù…Ù† - Ø§Ù„Ù…Ø±ÙƒØ² 351 Ø¥Ù„Ù‰ 400",
        color: "#ff9900",
        rankRange: "351-400"
      },
      {
        id: 9,
        name: "Triads",
        icon: "fas fa-yin-yang",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ø³Ø¹ - Ø§Ù„Ù…Ø±ÙƒØ² 401 Ø¥Ù„Ù‰ 450",
        color: "#ff6600",
        rankRange: "401-450"
      },
      {
        id: 10,
        name: "Yakuza",
        icon: "fas fa-user-ninja",
        capacity: 50,
        members: [],
        description: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ø´Ø± - Ø§Ù„Ù…Ø±ÙƒØ² 451 Ø¥Ù„Ù‰ 500",
        color: "#000000",
        rankRange: "451-500"
      }
    ];

    // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ==========
    const gameData = {
      user: null,
      dailyTasks: [
        { id: 1, title: "Ø´Ø§Ø±Ùƒ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚", description: "Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ 3 Ø£ØµØ¯Ù‚Ø§Ø¡", icon: "fas fa-share-alt", reward: 100, completed: false, type: "share" }
      ],
      
      achievements: [
        { id: 1, title: "Ø§Ù„Ù…Ø¨ØªØ¯Ø¦", description: "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø©", icon: "fas fa-star", reward: 100, unlocked: false },
        { id: 2, title: "Ù…Ø¯Ø§ÙˆÙ…", description: "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ 7 Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©", icon: "fas fa-fire", reward: 300, unlocked: false },
        { id: 3, title: "Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ", description: "Ø§Ø¯Ø¹Ùˆ 5 Ø£ØµØ¯Ù‚Ø§Ø¡", icon: "fas fa-users", reward: 500, unlocked: false },
        { id: 4, title: "Ø§Ù„Ø«Ø±Ø§Ø¡", description: "Ø§Ø¬Ù…Ø¹ 5000 Ù†Ù‚Ø·Ø©", icon: "fas fa-gem", reward: 1000, unlocked: false },
        { id: 5, title: "Ø§Ù„Ø¨Ø·Ù„", description: "ØªØµØ¯Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©", icon: "fas fa-trophy", reward: 2000, unlocked: false }
      ],
      
      leaderboard: {
        daily: [],
        weekly: [],
        all: []
      },

      friends: [],
      gifts: [
        { id: 1, title: "Ù‡Ø¯ÙŠØ© Ø§Ù„ØªØ±Ø­ÙŠØ¨", description: "50 Ù†Ù‚Ø·Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©", icon: "fas fa-gift", points: 50, sendable: true },
        { id: 2, title: "Ù‡Ø¯ÙŠØ© Ø§Ù„ØµØ¯Ø§Ù‚Ø©", description: "Ù…Ø¶Ø§Ø¹ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙŠÙˆÙ… ÙƒØ§Ù…Ù„", icon: "fas fa-heart", points: 100, sendable: true },
        { id: 3, title: "Ù‡Ø¯ÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ", description: "ØªØ­Ø¯ÙŠ Ø®Ø§Øµ Ù…Ø¹ ØµØ¯ÙŠÙ‚", icon: "fas fa-trophy", points: 150, sendable: true }
      ],

      challenges: [
        { id: 1, title: "ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„", description: "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ 5 Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©", icon: "fas fa-calendar", reward: 200, type: "daily", timeLeft: "2 ÙŠÙˆÙ…" },
        { id: 2, title: "ØªØ­Ø¯ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·", description: "Ø§Ø¬Ù…Ø¹ 1000 Ù†Ù‚Ø·Ø© ÙÙŠ Ø£Ø³Ø¨ÙˆØ¹", icon: "fas fa-coins", reward: 500, type: "weekly", timeLeft: "5 Ø£ÙŠØ§Ù…" },
        { id: 3, title: "ØªØ­Ø¯ÙŠ Ø§Ù„ØµØ¯Ø§Ù‚Ø©", description: "Ø§Ø±Ø³Ù„ Ù‡Ø¯Ø§ÙŠØ§ Ù„Ù€ 3 Ø£ØµØ¯Ù‚Ø§Ø¡", icon: "fas fa-user-friends", reward: 300, type: "daily", timeLeft: "1 ÙŠÙˆÙ…" }
      ],

      friendChallenges: [],
      groups: [],

      referrals: {
        total: 0,
        active: 0,
        points: 0,
        rewards: 0,
        rewardsList: [
          { id: 1, title: "3 Ø¥Ø­Ø§Ù„Ø§Øª", description: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 300 Ù†Ù‚Ø·Ø©", reward: 300, achieved: false },
          { id: 2, title: "5 Ø¥Ø­Ø§Ù„Ø§Øª", description: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 500 Ù†Ù‚Ø·Ø©", reward: 500, achieved: false },
          { id: 3, title: "10 Ø¥Ø­Ø§Ù„Ø§Øª", description: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù‡Ø¯ÙŠØ© Ù…Ù…ÙŠØ²Ø©", reward: "Ù‡Ø¯ÙŠØ© Ù…Ù…ÙŠØ²Ø©", achieved: false },
          { id: 4, title: "20 Ø¥Ø­Ø§Ù„Ø©", description: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 2000 Ù†Ù‚Ø·Ø©", reward: 2000, achieved: false }
        ]
      },

      shopItems: [
        { id: 1, title: "Ù‚Ø³ÙŠÙ…Ø© Ø£Ù…Ø§Ø²ÙˆÙ† 50 Ø±ÙŠØ§Ù„", description: "Ù‚Ø³ÙŠÙ…Ø© Ø´Ø±Ø§Ø¡ Ù…Ù† Ø£Ù…Ø§Ø²ÙˆÙ†", icon: "fas fa-shopping-cart", points: 5000, category: "physical" },
        { id: 2, title: "Ø§Ø´ØªØ±Ø§Ùƒ Ø³ØªÙˆØ±Ù‰ 3 Ø£Ø´Ù‡Ø±", description: "Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø³ØªÙˆØ±Ù‰", icon: "fas fa-film", points: 3000, category: "digital" },
        { id: 3, title: "Ø®ØµÙ… 20% Ø¹Ù„Ù‰ Ù†ÙˆÙ†", description: "Ø®ØµÙ… Ø¹Ù„Ù‰ Ù…Ø´ØªØ±ÙŠØ§Øª Ù†ÙˆÙ†", icon: "fas fa-tag", points: 1500, category: "discounts" },
        { id: 4, title: "Ø¨Ø·Ø§Ù‚Ø© Ø¢ÙŠØªÙˆÙ†Ø² 100 Ø±ÙŠØ§Ù„", description: "Ø¨Ø·Ø§Ù‚Ø© Ø´Ø­Ù† Ø¢ÙŠØªÙˆÙ†Ø²", icon: "fas fa-music", points: 2500, category: "digital" },
        { id: 5, title: "ØªØ°ÙƒØ±Ø© Ø³ÙŠÙ†Ù…Ø§", description: "ØªØ°ÙƒØ±Ø© Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠÙ„Ù…", icon: "fas fa-ticket-alt", points: 800, category: "physical" }
      ]
    };

    let currentUser = null;

    function calculateLevel(points) {
      if (points <= 0) return 1;
      if (points >= 5000000) return 100;
      
      const level = Math.floor(100 * Math.pow(points / 5000000, 1/2.8));
      return Math.max(1, Math.min(99, level));
    }

    async function loadUserData() {
      try {
        if (!currentUser || !currentUser.id) {
          throw new Error("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„");
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ©
        document.getElementById('userName').textContent = currentUser.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…';
        document.getElementById('avatarText').textContent = (currentUser.firstName || 'Ù…').charAt(0);
        document.querySelector('#userAvatar .quick-load').style.display = 'none';
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const dbStats = await getUserStatsFromDatabase(currentUser.id);
        
        if (dbStats) {
          // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          gameData.user = {
            id: currentUser.id,
            telegramId: currentUser.id,
            name: currentUser.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…',
            points: dbStats.totalPoints || 100,
            level: calculateLevel(dbStats.totalPoints || 100),
            streak: dbStats.currentStreak || 0,
            avatar: (currentUser.firstName || 'Ù…').charAt(0),
            referrals: dbStats.referrals || 0,
            referralPoints: dbStats.referralPoints || 0
          };
        } else {
          // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          gameData.user = {
            id: currentUser.id,
            telegramId: currentUser.id,
            name: currentUser.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…',
            points: 100,
            level: 1,
            streak: 0,
            avatar: (currentUser.firstName || 'Ù…').charAt(0),
            referrals: 0,
            referralPoints: 0
          };
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ø§Ù„Ù…Ù‡Ø§Ù…ØŒ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§ØªØŒ Ø¥Ù„Ø®) Ù…Ù† localStorage
        loadLocalGameData();
        
        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        return loadLocalUserData();
      }
    }

    function loadLocalGameData() {
      try {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù…Ù† localStorage
        const savedData = localStorage.getItem(`crynova_local_data_${currentUser.id}`);
        if (savedData) {
          const localData = JSON.parse(savedData);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
          if (localData.dailyTasks) {
            gameData.user.dailyTasks = localData.dailyTasks;
          }
          if (localData.achievements) {
            gameData.user.achievements = localData.achievements;
          }
          if (localData.friends) {
            gameData.friends = localData.friends;
          }
          if (localData.challenges) {
            gameData.challenges = localData.challenges;
          }
          if (localData.groups) {
            gameData.groups = localData.groups;
          }
        } else {
          // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          gameData.user.dailyTasks = gameData.dailyTasks.map(task => ({ ...task, completed: false }));
          gameData.user.achievements = gameData.achievements.map(ach => ({ ...ach, unlocked: false }));
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©:', error);
      }
    }

    function saveLocalGameData() {
      try {
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ localStorage
        const localData = {
          dailyTasks: gameData.user.dailyTasks || [],
          achievements: gameData.user.achievements || [],
          friends: gameData.friends || [],
          challenges: gameData.challenges || [],
          groups: gameData.groups || []
        };
        
        localStorage.setItem(`crynova_local_data_${currentUser.id}`, JSON.stringify(localData));
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©:', error);
        return false;
      }
    }

    function loadLocalUserData() {
      const userId = currentUser?.id || 'local_' + Date.now();
      const userName = currentUser?.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…';
      
      gameData.user = {
        id: userId,
        telegramId: userId,
        name: userName,
        points: 100,
        level: 1,
        streak: 0,
        avatar: userName.charAt(0),
        referrals: 0,
        referralPoints: 0,
        dailyTasks: gameData.dailyTasks.map(task => ({ ...task, completed: false })),
        achievements: gameData.achievements.map(ach => ({ ...ach, unlocked: false }))
      };
      
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…');
      return true;
    }

    // ========== Ø¯Ø§Ù„Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· ==========
    function distributePlayersToGroups(players) {
      if (!players || players.length === 0) return;
      
      // Ù…Ø³Ø­ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ† Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
      predefinedGroups.forEach(group => {
        group.members = [];
      });
      
      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· (ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹)
      const sortedPlayers = [...players].sort((a, b) => b.points - a.points);
      
      // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
      sortedPlayers.forEach((player, index) => {
        const groupIndex = Math.floor(index / 50); // ÙƒÙ„ 50 Ù„Ø§Ø¹Ø¨ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø©
        if (groupIndex < predefinedGroups.length) {
          const positionInGroup = index % 50; // Ø§Ù„Ù…Ø±ÙƒØ² Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (0-49)
          const rankTitle = groupRanks[positionInGroup] || `Veteran ${positionInGroup + 1}`;
          
          // ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø§Ù„Ø±ØªØ¨Ø©
          let rankCategory = "veteran";
          if (positionInGroup < 3) rankCategory = "core"; // Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙŠØ§
          else if (positionInGroup < 10) rankCategory = "elite"; // Ø§Ù„Ù†Ø®Ø¨Ø©
          else if (positionInGroup < 15) rankCategory = "officer"; // Ø§Ù„Ø¶Ø¨Ø§Ø·
          
          const playerWithRank = {
            ...player,
            globalRank: index + 1,
            groupRank: positionInGroup + 1,
            rankTitle: rankTitle,
            rankCategory: rankCategory,
            isCurrentUser: player.id === (gameData.user?.id || currentUser?.id)
          };
          predefinedGroups[groupIndex].members.push(playerWithRank);
        }
      });
      
      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø¯Ø§Ø®Ù„ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø±ØªØ¨Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„)
      predefinedGroups.forEach(group => {
        group.members.sort((a, b) => b.points - a.points);
      });
      
      console.log(`âœ… ØªÙ… ØªÙˆØ²ÙŠØ¹ ${sortedPlayers.length} Ù„Ø§Ø¹Ø¨ Ø¹Ù„Ù‰ ${predefinedGroups.length} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª`);
    }

    // ========== Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
    async function fetchPlayersForGroups() {
      try {
        console.log('ğŸ”„ Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„ØªÙˆØ²ÙŠØ¹Ù‡Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª...');
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (db) {
          const usersSnapshot = await db.collection('users')
            .orderBy('totalPoints', 'desc')
            .limit(500) // Ù†Ø¬Ù„Ø¨ Ø£ÙˆÙ„ 500 Ù„Ø§Ø¹Ø¨ ÙÙ‚Ø·
            .get();
          
        if (!usersSnapshot.empty) {
            const players = [];
            
            usersSnapshot.forEach(doc => {
              const userData = doc.data();
              players.push({
                id: doc.id,
                name: userData.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…',
                avatar: (userData.firstName || 'Ù…').charAt(0),
                points: userData.totalPoints || 0,
                level: calculateLevel(userData.totalPoints || 0)
              });
            });
            
            return players;
          }
        }
        
        // Ø¥Ø°Ø§ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ©
        console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†');
        return generateMockPlayers(300); // 300 Ù„Ø§Ø¹Ø¨ ÙˆÙ‡Ù…ÙŠ
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:', error);
        return generateMockPlayers(150); // 150 Ù„Ø§Ø¹Ø¨ ÙˆÙ‡Ù…ÙŠ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
      }
    }

    // ========== Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆÙ‡Ù…ÙŠÙŠÙ† ==========
    function generateMockPlayers(count) {
      const firstNames = ["Ø£Ø­Ù…Ø¯", "Ù…Ø­Ù…Ø¯", "Ø¹Ù„ÙŠ", "Ù…ØµØ·ÙÙ‰", "Ø®Ø§Ù„Ø¯", "Ø¹Ù…Ø±", "ÙŠÙˆØ³Ù", "Ø­Ø³Ù†", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ù…Ø­Ù…ÙˆØ¯", "Ø³Ø¹ÙŠØ¯", "Ø·Ø§Ø±Ù‚", "Ø±Ø§Ù…ÙŠ", "ÙˆÙ„ÙŠØ¯", "ÙØ§Ø±Ø³", "Ù†Ø§ØµØ±", "Ø³Ù„Ù…Ø§Ù†", "ÙÙ‡Ø¯", "Ø¨Ù†Ø¯Ø±", "Ù†Ø§ÙŠÙ"];
      const lastNames = ["Ø§Ù„ÙØªØ§Ø­", "Ø§Ù„ÙƒØ±ÙŠÙ…", "Ø§Ù„Ø¹Ø²ÙŠØ²", "Ø§Ù„Ø­ÙƒÙŠÙ…", "Ø§Ù„ÙˆØ¯ÙˆØ¯", "Ø§Ù„ØºÙÙˆØ±", "Ø§Ù„Ø´ÙƒÙˆØ±", "Ø§Ù„Ø¹Ù„ÙŠÙ…", "Ø§Ù„Ø­Ù„ÙŠÙ…", "Ø§Ù„Ø¹Ø¸ÙŠÙ…", "Ø§Ù„ØºÙØ§Ø±", "Ø§Ù„Ù‚Ù‡Ø§Ø±", "Ø§Ù„ÙˆÙ‡Ø§Ø¨", "Ø§Ù„Ø±Ø²Ø§Ù‚", "Ø§Ù„ÙØªØ§Ù‚", "Ø§Ù„Ø¬Ø¨Ø§Ø±", "Ø§Ù„Ù…ØªÙƒØ¨Ø±", "Ø§Ù„Ø®Ù„Ø§Ù‚", "Ø§Ù„ØºÙÙˆØ±", "Ø§Ù„Ø´ÙƒÙˆØ±"];
      
      const players = [];
      
      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
      if (gameData.user) {
        players.push({
          id: gameData.user.id,
          name: gameData.user.name,
          avatar: gameData.user.avatar,
          points: gameData.user.points,
          level: gameData.user.level,
          isCurrentUser: true
        });
      }
      
      // Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆÙ‡Ù…ÙŠÙŠÙ†
      for (let i = 0; i < count - 1; i++) {
        const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
        const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
        const points = Math.floor(Math.random() * 50000) + 1000;
        
        players.push({
          id: `mock_player_${i}`,
          name: `${firstName} ${lastName}`,
          avatar: firstName.charAt(0),
          points: points,
          level: calculateLevel(points)
        });
      }
      
      return players;
    }

    // ========== Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ==========
    function renderGroups() {
      const groupsContainer = document.getElementById('groupsContainer');
      groupsContainer.innerHTML = '';
      
      if (!predefinedGroups || predefinedGroups.length === 0) {
        groupsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-light)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
        hideQuickLoading('groupsList');
        return;
      }
      
      predefinedGroups.forEach(group => {
        const groupEl = document.createElement('div');
        groupEl.className = 'group-card';
        groupEl.style.borderLeft = `4px solid ${group.color}`;
        
        const isCurrentUserInGroup = group.members.some(member => member.isCurrentUser);
        const memberCount = group.members.length;
        const capacityPercent = (memberCount / group.capacity) * 100;
        
        // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        const totalPoints = group.members.reduce((sum, member) => sum + member.points, 0);
        const topPlayer = memberCount > 0 ? group.members[0] : null;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        let status = "active";
        let statusText = `Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${memberCount}/${group.capacity}`;
        
        if (memberCount === 0) {
          status = "empty";
          statusText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø¹Ø¯";
        } else if (memberCount >= group.capacity) {
          status = "full";
          statusText = "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù…ØªÙ„Ø¦Ø©";
        }
        
        groupEl.innerHTML = `
          <div class="group-card-header">
            <div class="group-name">
              <i class="${group.icon}"></i>
              <span>${group.name}</span>
            </div>
            <div class="group-rank">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${group.id}</div>
          </div>
          
          <div class="group-range">
            <i class="fas fa-chart-line"></i>
            ${group.description}
          </div>
          
          <div class="group-stats">
            <div class="stat-item">
              <div class="stat-value">${group.capacity}</div>
              <div class="stat-label">Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">${memberCount}</div>
              <div class="stat-label">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">${totalPoints.toLocaleString('en-US')}</div>
              <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
            </div>
          </div>
          
          <div class="group-members">
            <div class="members-title">
              <span>Ø£ÙØ¶Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</span>
              <span style="font-size: 11px; color: var(--text-light)">
                ${topPlayer ? `Ø§Ù„Ø£Ø¹Ù„Ù‰: ${topPlayer.points.toLocaleString('en-US')}` : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
              </span>
            </div>
            
            <div class="members-scroll">
              ${memberCount > 0 ? 
                group.members.slice(0, 15).map((member, index) => `
                  <div class="member-item ${member.isCurrentUser ? 'me' : ''}">
                    <div class="member-info">
                      <div class="member-position ${member.rankCategory}" title="${member.rankTitle}">
                        ${member.groupRank}
                      </div>
                      <div class="member-avatar">${member.avatar}</div>
                      <div class="member-details">
                        <div class="member-name" title="${member.name}">${member.name}</div>
                        <div class="member-title">${member.rankTitle}</div>
                      </div>
                    </div>
                    <div class="member-points english-numbers">${member.points.toLocaleString('en-US')}</div>
                  </div>
                `).join('') : 
                `<div style="text-align: center; padding: 20px; color: var(--text-light); font-size: 13px;">
                  <i class="fas fa-user-slash"></i><br/>
                  Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø¹Ø¯
                </div>`
              }
              
              ${memberCount > 15 ? `
                <div style="text-align: center; padding: 8px; font-size: 11px; color: var(--text-light);">
                  Ùˆ <span class="english-numbers">${memberCount - 15}</span> Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±
                </div>
              ` : ''}
            </div>
          </div>
          
          <div class="group-status ${status}">
            ${statusText}
            ${isCurrentUserInGroup ? ' â€¢ <i class="fas fa-user-check"></i> Ø£Ù†Øª Ù‡Ù†Ø§' : ''}
          </div>
        `;
        
        groupsContainer.appendChild(groupEl);
      });
      
      hideQuickLoading('groupsList');
    }

    async function loadAdditionalData() {
      try {
        console.log('ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©...');
        
        // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        gameData.leaderboard.all = await getLeaderboardFromDatabase();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        loadLocalGameData();
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØªÙˆØ²ÙŠØ¹Ù‡Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
        const players = await fetchPlayersForGroups();
        distributePlayersToGroups(players);
        
        // Ø¹Ø±Ø¶ ÙƒÙ„ Ø´ÙŠØ¡
        renderDailyTasks();
        renderAchievements();
        renderLeaderboard('all');
        renderGifts();
        renderChallenges();
        renderGroups();
        renderReferrals();
        renderShopItems();
        
        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©');
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©:', error);
      }
    }

    // ========== Ø¯Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ==========
    function renderCheckinCalendar() {
      const daysOfWeek = ['Ø£', 'Ø¥', 'Ø«', 'Ø£', 'Ø®', 'Ø¬', 'Ø³'];
      const today = new Date();
      const currentDay = today.getDay();
      
      const calendarEl = document.getElementById('calendarCircles');
      calendarEl.innerHTML = '';
      
      // Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø³ØªØ®Ø¯Ù… localStorage ÙÙ‚Ø·
      const lastCheckin = localStorage.getItem(`lastCheckin_${currentUser.id}`);
      const lastCheckinDate = lastCheckin ? new Date(lastCheckin) : null;
      const startOfWeek = new Date(today);
      startOfWeek.setDate(today.getDate() - currentDay);
      
      let checkedDays = 0;
      
      for (let i = 0; i < 7; i++) {
        const dayDate = new Date(startOfWeek);
        dayDate.setDate(startOfWeek.getDate() + i);
        
        const isToday = i === currentDay;
        const isPast = i < currentDay;
        const isChecked = lastCheckinDate && 
                         lastCheckinDate.toDateString() === dayDate.toDateString();
        
        if (isChecked) checkedDays++;
        
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-circle';
        if (isChecked) dayEl.classList.add('checked');
        if (isToday) dayEl.classList.add('today');
        if (!isPast && !isToday) dayEl.classList.add('future');
        if (i === 6) dayEl.classList.add('special');
        
        dayEl.title = `${['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'][i]} - ${50 + (i * 10)} Ù†Ù‚Ø·Ø©${i === 6 ? ' (Ù…Ø¶Ø§Ø¹ÙØ©)' : ''}`;
        
        if (isChecked) {
          dayEl.innerHTML = '<div class="circle-check">âœ“</div>';
        } else if (isToday) {
          dayEl.innerHTML = '<div class="circle-today">!</div>';
        } else {
          dayEl.innerHTML = `<div class="circle-day">${daysOfWeek[i]}</div>`;
        }
        
        if (i === 6) {
          dayEl.innerHTML += '<div class="circle-bonus">Ã—2</div>';
        }
        
        calendarEl.appendChild(dayEl);
      }
      
      const progressPercent = (checkedDays / 7) * 100;
      document.querySelector('.progress-fill').style.width = `${progressPercent}%`;
      document.querySelector('.progress-text').innerHTML = `<span class="english-numbers">${checkedDays}</span>/7 Ø£ÙŠØ§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹`;
    }

    function checkDailyCheckin() {
      if (!gameData.user) return;
      
      const today = new Date().toDateString();
      const lastCheckin = localStorage.getItem(`lastCheckin_${currentUser.id}`);
      const checkinButton = document.getElementById('checkinButton');
      
      if (lastCheckin === today) {
        checkinButton.disabled = true;
        checkinButton.classList.add('checked');
        checkinButton.innerHTML = '<i class="fas fa-check-circle"></i><span>ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…</span>';
      } else {
        checkinButton.disabled = false;
        checkinButton.classList.remove('checked');
      }
    }

    function renderDailyTasks() {
      if (!gameData.user || !gameData.user.dailyTasks) {
        gameData.user.dailyTasks = gameData.dailyTasks.map(task => ({ ...task, completed: false }));
      }
      
      const tasksListEl = document.getElementById('tasksList');
      tasksListEl.innerHTML = '';
      
      gameData.user.dailyTasks.forEach(task => {
        const taskEl = document.createElement('div');
        taskEl.className = `task-item ${task.completed ? 'completed' : ''}`;
        
        taskEl.innerHTML = `
          <div class="task-info">
            <div class="task-icon">
              <i class="${task.icon}"></i>
            </div>
            <div class="task-details">
              <h4>${task.title}</h4>
              <p>${task.description}</p>
            </div>
          </div>
          <button class="task-action ${task.completed ? 'completed' : ''}" data-task-id="${task.id}" ${task.completed ? 'disabled' : ''}>
            ${task.completed ? '<i class="fas fa-check"></i>' : `<span class="english-numbers">+${task.reward}</span>`}
          </button>
        `;
        
        tasksListEl.appendChild(taskEl);
      });
      
      hideQuickLoading('tasksList');
    }

    // === Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¯Ø§Ù„Ø© renderAchievements Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ===
    function renderAchievements() {
      if (!gameData.user || !gameData.user.achievements) {
        gameData.user.achievements = gameData.achievements.map(ach => ({ ...ach, unlocked: false }));
      }
      
      const achievementsGridEl = document.getElementById('achievementsGrid');
      achievementsGridEl.innerHTML = '';
      
      gameData.user.achievements.forEach(achievement => {
        const achievementEl = document.createElement('div');
        achievementEl.className = `achievement-item ${achievement.unlocked ? 'unlocked' : 'locked'}`;
        
        achievementEl.innerHTML = `
          <div class="achievement-icon">
            <i class="${achievement.icon}"></i>
          </div>
          <div class="achievement-details">
            <h4>${achievement.title}</h4>
            <p>${achievement.description}</p>
            <div class="achievement-reward"><span class="english-numbers">+${achievement.reward}</span> Ù†Ù‚Ø·Ø©</div>
          </div>
          <div class="achievement-status ${achievement.unlocked ? 'unlocked' : 'locked'}">
            <i class="fas fa-${achievement.unlocked ? 'lock-open' : 'lock'}"></i>
          </div>
        `;
        
        achievementsGridEl.appendChild(achievementEl);
      });
      
      hideQuickLoading('achievementsGrid');
    }
    // === Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ===

    async function renderLeaderboard(period) {
      const leaderboardListEl = document.getElementById('leaderboardList');
      leaderboardListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-light)">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const players = await getLeaderboardFromDatabase();
      
      leaderboardListEl.innerHTML = '';
      
      if (players.length === 0) {
        leaderboardListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-light)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</div>';
        return;
      }
      
      players.forEach((player, index) => {
        const playerEl = document.createElement('div');
        playerEl.className = `leaderboard-item ${player.id === currentUser?.id ? 'me' : ''}`;
        
        const rankClass = index < 3 ? `top-${index + 1}` : '';
        
        playerEl.innerHTML = `
          <div class="leaderboard-rank ${rankClass} english-numbers">${index + 1}</div>
          <div class="leaderboard-user">
            <div class="leaderboard-avatar">${player.avatar}</div>
            <div>
              <div class="leaderboard-name">${player.name}</div>
              <div style="font-size: 12px; color: var(--text-light)">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span class="english-numbers">${player.level}</span></div>
            </div>
          </div>
          <div class="leaderboard-points english-numbers">${player.points.toLocaleString('en-US')}</div>
        `;
        
        leaderboardListEl.appendChild(playerEl);
      });
      
      hideQuickLoading('leaderboardList');
    }

    function renderGifts() {
      const giftsListEl = document.getElementById('giftsList');
      giftsListEl.innerHTML = '';
      
      gameData.gifts.forEach(gift => {
        const giftEl = document.createElement('div');
        giftEl.className = 'gift-item';
        
        giftEl.innerHTML = `
          <div class="gift-info">
            <div class="gift-icon">
              <i class="${gift.icon}"></i>
            </div>
            <div class="gift-details">
              <h4>${gift.title}</h4>
              <p>${gift.description}</p>
            </div>
          </div>
          <div>
            <button class="gift-action ${gift.sendable ? '' : 'disabled'}" data-gift-id="${gift.id}" ${!gift.sendable ? 'disabled' : ''}>
              ${gift.sendable ? `Ø£Ø±Ø³Ù„ (<span class="english-numbers">+${gift.points}</span>)` : 'ØºÙŠØ± Ù…ØªØ§Ø­'}
            </button>
          </div>
        `;
        
        giftsListEl.appendChild(giftEl);
      });
      
      hideQuickLoading('giftsList');
    }

    function renderChallenges() {
      const challengesListEl = document.getElementById('challengesList');
      challengesListEl.innerHTML = '';
      
      gameData.challenges.forEach(challenge => {
        const challengeEl = document.createElement('div');
        challengeEl.className = 'challenge-item';
        
        challengeEl.innerHTML = `
          <div class="challenge-info">
            <div class="challenge-icon">
              <i class="${challenge.icon}"></i>
            </div>
            <div class="challenge-details">
              <h4>${challenge.title}</h4>
              <p>${challenge.description} â€¢ ${challenge.timeLeft} Ù…ØªØ¨Ù‚ÙŠ</p>
            </div>
          </div>
          <div>
            <button class="challenge-action" data-challenge-id="${challenge.id}">
              Ø§Ø¨Ø¯Ø£ (<span class="english-numbers">+${challenge.reward}</span>)
            </button>
          </div>
        `;
        
        challengesListEl.appendChild(challengeEl);
      });
      
      hideQuickLoading('challengesList');
    }

    function renderReferrals() {
      if (!gameData.user) return;
      
      document.getElementById('totalReferrals').textContent = gameData.user.referrals || 0;
      document.getElementById('activeReferrals').textContent = gameData.user.referrals || 0;
      document.getElementById('referralPoints').textContent = (gameData.user.referralPoints || 0).toLocaleString('en-US');
      document.getElementById('referralRewards').textContent = gameData.referrals.rewards;
      
      const rewardsListEl = document.getElementById('referralRewardsList');
      rewardsListEl.innerHTML = '';
      
      const updatedRewards = gameData.referrals.rewardsList.map(reward => {
        const requiredReferrals = parseInt(reward.title.match(/\d+/)[0]);
        return {
          ...reward,
          achieved: (gameData.user.referrals || 0) >= requiredReferrals
        };
      });
      
      updatedRewards.forEach(reward => {
        const rewardEl = document.createElement('div');
        rewardEl.className = 'gift-item';
        
        const rewardText = typeof reward.reward === 'number' ? 
          `<span class="english-numbers">${reward.reward}</span> Ù†Ù‚Ø·Ø©` : 
          reward.reward;
        
        rewardEl.innerHTML = `
          <div class="gift-info">
            <div class="gift-icon" style="background: ${reward.achieved ? 'linear-gradient(135deg, var(--success), #1dd1a1)' : 'linear-gradient(135deg, #cccccc, #999999)'};">
              <i class="fas fa-award"></i>
            </div>
            <div class="gift-details">
              <h4>${reward.title}</h4>
              <p>${reward.description}</p>
            </div>
          </div>
          <div>
            <button class="gift-action ${reward.achieved ? 'completed' : ''}" data-reward-id="${reward.id}" ${!reward.achieved ? 'disabled' : ''}>
              ${reward.achieved ? 'Ø§Ø³ØªÙ„Ù…' : 'ØºÙŠØ± Ù…ÙØ¹Ù„'}
            </button>
          </div>
        `;
        
        rewardsListEl.appendChild(rewardEl);
      });
      
      hideQuickLoading('referralRewardsList');
    }

    function renderShopItems(category = 'all') {
      const shopItemsEl = document.getElementById('shopItems');
      shopItemsEl.innerHTML = '';
      
      let filteredItems = gameData.shopItems;
      if (category !== 'all') {
        filteredItems = gameData.shopItems.filter(item => item.category === category);
      }
      
      if (filteredItems.length === 0) {
        shopItemsEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-light)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</div>';
        return;
      }
      
      filteredItems.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'shop-item';
        
        const canAfford = gameData.user.points >= item.points;
        
        itemEl.innerHTML = `
          <div class="shop-info">
            <div class="shop-icon">
              <i class="${item.icon}"></i>
            </div>
            <div class="shop-details">
              <h4>${item.title}</h4>
              <p>${item.description}</p>
              <div style="font-size: 12px; color: ${canAfford ? 'var(--success)' : 'var(--danger)'}; margin-top: 5px;">
                <span class="english-numbers">${item.points.toLocaleString('en-US')}</span> Ù†Ù‚Ø·Ø© ${!canAfford ? 'â€¢ Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ©' : ''}
              </div>
            </div>
          </div>
          <div>
            <button class="shop-action ${canAfford ? '' : 'disabled'}" data-item-id="${item.id}" ${!canAfford ? 'disabled' : ''}>
              ${canAfford ? 'Ø§Ø´ØªØ±ÙŠ Ø§Ù„Ø¢Ù†' : 'Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ©'}
            </button>
          </div>
        `;
        
        shopItemsEl.appendChild(itemEl);
      });
      
      hideQuickLoading('shopItems');
    }

    // ========== ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
    function updateUserInfo() {
      if (!gameData.user) return;
      
      document.getElementById('userName').textContent = gameData.user.name || currentUser?.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…';
      document.getElementById('avatarText').textContent = gameData.user.avatar || (currentUser?.firstName?.charAt(0) || 'Ù…');
      document.getElementById('userLevel').textContent = gameData.user.level || 1;
      document.getElementById('totalPoints').textContent = (gameData.user.points || 0).toLocaleString('en-US');
      document.getElementById('streakBadge').innerHTML = `ğŸ”¥ <span class="english-numbers">${gameData.user.streak || 0}</span> Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©`;
      
      // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ­Øª Ø§Ù„Ø§Ø³Ù…
      const userUsernameEl = document.getElementById('userUsername');
      if (currentUser && currentUser.username) {
        userUsernameEl.textContent = `@${currentUser.username}`;
        userUsernameEl.style.display = 'block';
      } else {
        userUsernameEl.style.display = 'none';
      }
      
      // Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© - ØªØ­Ø¯ÙŠØ« Ù„ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø¨ÙˆØª Telegram
      if (currentUser && currentUser.id) {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØª Ù…Ø¹ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
        const referralLink = `https://t.me/Coin_Crynova_bot?start=${currentUser.id}`;
        document.getElementById('friendReferralLink').textContent = referralLink;
        document.getElementById('referralLink').value = referralLink;
      } else {
        const referralCode = gameData.user.telegramId || gameData.user.id || 'unknown';
        const referralLink = `https://t.me/Coin_Crynova_bot?start=${referralCode}`;
        document.getElementById('friendReferralLink').textContent = referralLink;
        document.getElementById('referralLink').value = referralLink;
      }
      
      document.getElementById('totalFriendReferrals').textContent = gameData.user.referrals || 0;
      document.getElementById('referralEarnings').textContent = (gameData.user.referralPoints || 0).toLocaleString('en-US');
      document.getElementById('totalReferrals').textContent = gameData.user.referrals || 0;
      document.getElementById('referralPoints').textContent = (gameData.user.referralPoints || 0).toLocaleString('en-US');
    }

    // ========== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ==========
    function setupEventListeners() {
      document.getElementById('checkinButton').addEventListener('click', handleDailyCheckin);
      
      document.addEventListener('click', function(e) {
        if (e.target.closest('.task-action')) {
          const button = e.target.closest('.task-action');
          const taskId = parseInt(button.getAttribute('data-task-id'));
          completeTask(taskId);
        }
        
        if (e.target.closest('.gift-action') && e.target.closest('.gift-action').getAttribute('data-gift-id')) {
          const button = e.target.closest('.gift-action');
          const giftId = parseInt(button.getAttribute('data-gift-id'));
          sendGift(giftId);
        }
        
        if (e.target.closest('.challenge-action') && e.target.closest('.challenge-action').getAttribute('data-challenge-id')) {
          const button = e.target.closest('.challenge-action');
          const challengeId = parseInt(button.getAttribute('data-challenge-id'));
          startChallenge(challengeId);
        }
        
        if (e.target.closest('.shop-action')) {
          const button = e.target.closest('.shop-action');
          const itemId = parseInt(button.getAttribute('data-item-id'));
          purchaseItem(itemId);
        }
        
        if (e.target.closest('.gift-action') && e.target.closest('.gift-action').getAttribute('data-reward-id')) {
          const button = e.target.closest('.gift-action');
          const rewardId = parseInt(button.getAttribute('data-reward-id'));
          claimReferralReward(rewardId);
        }
      });
      
      document.querySelectorAll('.leaderboard-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          const period = this.getAttribute('data-period');
          renderLeaderboard(period);
        });
      });
      
      document.querySelectorAll('.shop-tabs .leaderboard-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          document.querySelectorAll('.shop-tabs .leaderboard-tab').forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          const category = this.getAttribute('data-category');
          renderShopItems(category);
        });
      });
      
      document.querySelectorAll('.bottom-nav .nav-item').forEach(item => {
        item.addEventListener('click', function() {
          document.querySelectorAll('.bottom-nav .nav-item').forEach(nav => nav.classList.remove('active'));
          this.classList.add('active');
          
          const section = this.id.replace('nav', '').toLowerCase();
          navigateToSection(section);
        });
      });
      
      document.getElementById('copyReferralLink').addEventListener('click', function() {
        const referralLink = document.getElementById('referralLink');
        referralLink.select();
        document.execCommand('copy');
        showMessage('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
      });
      
      document.getElementById('copyFriendReferralLink').addEventListener('click', function() {
        const referralLink = document.getElementById('friendReferralLink').textContent;
        const tempInput = document.createElement('input');
        tempInput.value = referralLink;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        showMessage('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø¨Ù†Ø¬Ø§Ø­! Ø´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ.');
      });
    }

    function hideAllNewSections() {
      const newSections = ['sectionFriends', 'sectionChallenges', 'sectionGroups', 'sectionReferrals', 'sectionShop'];
      newSections.forEach(sectionId => {
        document.getElementById(sectionId).classList.add('section-hidden');
      });
      
      document.getElementById('sectionHome').classList.remove('section-hidden');
    }

    function navigateToSection(section) {
      const allSections = document.querySelectorAll('#sectionHome, #sectionFriends, #sectionChallenges, #sectionGroups, #sectionReferrals, #sectionShop');
      allSections.forEach(sec => {
        sec.classList.add('section-hidden');
      });
      
      if (section === 'home') {
        document.getElementById('sectionHome').classList.remove('section-hidden');
      } else if (section === 'friends') {
        document.getElementById('sectionFriends').classList.remove('section-hidden');
      } else if (section === 'challenges') {
        document.getElementById('sectionChallenges').classList.remove('section-hidden');
      } else if (section === 'groups') {
        document.getElementById('sectionGroups').classList.remove('section-hidden');
      } else if (section === 'shop') {
        document.getElementById('sectionShop').classList.remove('section-hidden');
      }
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ========== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ø¹Ø¨Ø© ==========
    async function handleDailyCheckin() {
      if (!gameData.user) {
        showMessage('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ...');
        return;
      }
      
      const today = new Date().toISOString().split('T')[0];
      const lastCheckin = localStorage.getItem(`lastCheckin_${currentUser.id}`);
      
      if (lastCheckin === today) {
        showMessage('Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!');
        return;
      }
      
      try {
        const streakBonus = Math.min(gameData.user.streak * 5, 50);
        const basePoints = 50;
        const totalPoints = basePoints + streakBonus;
        
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        let newStreak = 1;
        if (lastCheckin === yesterdayStr) {
          newStreak = gameData.user.streak + 1;
        } else if (lastCheckin === today) {
          showMessage('Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!');
          return;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await updateUserPoints(currentUser.id, totalPoints, 'Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØªØ§Ø¨Ø¹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await updateUserStreak(currentUser.id, newStreak, today);
        
        // Ø­ÙØ¸ Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·
        localStorage.setItem(`lastCheckin_${currentUser.id}`, today);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        gameData.user.points += totalPoints;
        gameData.user.streak = newStreak;
        gameData.user.level = calculateLevel(gameData.user.points);
        
        updateUserInfo();
        checkDailyCheckin();
        renderCheckinCalendar();
        
        showMessage(`Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª ${totalPoints.toLocaleString('en-US')} Ù†Ù‚Ø·Ø© (${basePoints.toLocaleString('en-US')} + ${streakBonus.toLocaleString('en-US')} Ù…ÙƒØ§ÙØ£Ø© ØªØªØ§Ø¨Ø¹)`);
        animatePoints(totalPoints);
        
        checkAchievements();
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ:', error);
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ');
      }
    }

    async function completeTask(taskId) {
      if (!gameData.user) return;
      
      const task = gameData.user.dailyTasks.find(t => t.id === taskId);
      
      if (!task || task.completed) {
        showMessage('Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„!');
        return;
      }
      
      try {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await updateUserPoints(currentUser.id, task.reward, `Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©: ${task.title}`);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        gameData.user.points += task.reward;
        gameData.user.level = calculateLevel(gameData.user.points);
        task.completed = true;
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        saveLocalGameData();
        
        updateUserInfo();
        renderDailyTasks();
        
        showMessage(`Ø£Ø­Ø³Ù†Øª! Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ù‡Ù…Ø© ÙˆØ±Ø¨Ø­Øª ${task.reward.toLocaleString('en-US')} Ù†Ù‚Ø·Ø©`);
        animatePoints(task.reward);
        
        checkAchievements();
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©:', error);
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©');
      }
    }

    async function sendGift(giftId) {
      const gift = gameData.gifts.find(g => g.id === giftId);
      if (!gift || !gift.sendable) return;
      
      if (gameData.user.points < gift.points) {
        showMessage('Ù†Ù‚Ø§Ø·Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‡Ø¯ÙŠØ©!');
        return;
      }
      
      showMessage(`Ø§Ø®ØªØ± ØµØ¯ÙŠÙ‚Ø§Ù‹ Ù„Ø¥Ø±Ø³Ø§Ù„ ${gift.title} Ø¥Ù„ÙŠÙ‡`);
    }

    async function startChallenge(challengeId) {
      const challenge = gameData.challenges.find(c => c.id === challengeId);
      if (!challenge) return;
      
      showMessage(`Ø¨Ø¯Ø£Øª ØªØ­Ø¯ÙŠ "${challenge.title}"! Ù„Ø¯ÙŠÙƒ ${challenge.timeLeft} Ù„Ø¥ÙƒÙ…Ø§Ù„Ù‡.`);
    }

    async function purchaseItem(itemId) {
      const item = gameData.shopItems.find(i => i.id === itemId);
      if (!item) return;
      
      if (gameData.user.points < item.points) {
        showMessage('Ù†Ù‚Ø§Ø·Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ø´Ø±Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±!');
        return;
      }
      
      if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø´Ø±Ø§Ø¡ "${item.title}" Ù…Ù‚Ø§Ø¨Ù„ ${item.points.toLocaleString('en-US')} Ù†Ù‚Ø·Ø©ØŸ`)) {
        try {
          // Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          await updateUserPoints(currentUser.id, -item.points, `Ø´Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±: ${item.title}`);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
          gameData.user.points -= item.points;
          gameData.user.level = calculateLevel(gameData.user.points);
          
          updateUserInfo();
          renderShopItems();
          
          showMessage(`ØªÙ… Ø´Ø±Ø§Ø¡ "${item.title}" Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù…ØªØ¬Ø± Crynova.`);
          
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù†ØµØ±:', error);
          showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡');
        }
      }
    }

    async function claimReferralReward(rewardId) {
      const reward = gameData.referrals.rewardsList.find(r => r.id === rewardId);
      if (!reward || !reward.achieved) {
        showMessage('Ù„Ù… ØªØ­Ù‚Ù‚ Ø´Ø±ÙˆØ· Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø¨Ø¹Ø¯');
        return;
      }
      
      try {
        if (typeof reward.reward === 'number') {
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          await updateUserPoints(currentUser.id, reward.reward, `Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø©: ${reward.title}`);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
          gameData.user.points += reward.reward;
          gameData.user.level = calculateLevel(gameData.user.points);
          
          showMessage(`Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${reward.reward.toLocaleString('en-US')} Ù†Ù‚Ø·Ø© Ù…ÙƒØ§ÙØ£Ø©`);
        } else {
          showMessage(`Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${reward.reward}`);
        }
        
        updateUserInfo();
        renderReferrals();
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©:', error);
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©');
      }
    }

    async function checkAchievements() {
      if (!gameData.user || !gameData.user.achievements) return;
      
      let updated = false;
      
      if (gameData.user.points >= 1000) {
        const achievement = gameData.user.achievements.find(a => a.id === 1);
        if (achievement && !achievement.unlocked) {
          achievement.unlocked = true;
          updated = true;
        }
      }
      
      const lastCheckin = localStorage.getItem(`lastCheckin_${currentUser.id}`);
      if (lastCheckin) {
        // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØªØ§Ø¨Ø¹ Ù…Ù† localStorage
        const streak = gameData.user.streak || 0;
        if (streak >= 7) {
          const achievement = gameData.user.achievements.find(a => a.id === 2);
          if (achievement && !achievement.unlocked) {
            achievement.unlocked = true;
            updated = true;
          }
        }
      }
      
      if (gameData.user.points >= 5000) {
        const achievement = gameData.user.achievements.find(a => a.id === 4);
        if (achievement && !achievement.unlocked) {
          achievement.unlocked = true;
          updated = true;
        }
      }
      
      if (gameData.user.referrals >= 5) {
        const achievement = gameData.user.achievements.find(a => a.id === 3);
        if (achievement && !achievement.unlocked) {
          achievement.unlocked = true;
          updated = true;
        }
      }
      
      if (updated) {
        saveLocalGameData();
        renderAchievements();
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        showMessage('ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø­Ù‚Ù‚Øª Ø¥Ù†Ø¬Ø§Ø²Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹');
      }
    }

    // ========== ØªÙ‡ÙŠØ¦Ø© Telegram WebApp Ù…Ø¹ Ø¨ÙˆØª @Coin_Crynova_bot ==========
    async function initializeWithTelegramBot() {
      try {
        console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ù…Ø¹ Ø¨ÙˆØª Telegram @Coin_Crynova_bot...');
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‡ÙŠØ¦Ø© Telegram WebApp
        const telegramUser = initializeTelegramWebApp();
        
        if (telegramUser) {
          console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù… Telegram:', telegramUser);
          
          currentUser = {
            id: telegramUser.id.toString(),
            telegramId: telegramUser.id.toString(),
            firstName: telegramUser.first_name || 'Ù…Ø³ØªØ®Ø¯Ù…',
            lastName: telegramUser.last_name || '',
            username: telegramUser.username || null,
            languageCode: telegramUser.language_code || 'ar'
          };
          
          // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙˆØ±Ø§Ù‹
          document.getElementById('userName').textContent = currentUser.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…';
          document.getElementById('avatarText').textContent = (currentUser.firstName || 'Ù…').charAt(0);
          document.getElementById('userUsername').textContent = currentUser.username ? `@${currentUser.username}` : '';
          document.getElementById('userUsername').style.display = currentUser.username ? 'block' : 'none';
          
          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© (start parameter)
          if (tg && tg.initDataUnsafe?.start_param) {
            const startParam = tg.initDataUnsafe.start_param;
            console.log('ğŸ”— Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©:', startParam);
            
            if (startParam && startParam !== '' && startParam !== currentUser.id) {
              const referrerId = startParam;
              if (referrerId !== currentUser.id) {
                try {
                  await addReferralToDatabase(referrerId, currentUser.id);
                  showMessage('ğŸ‰ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø­Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù….');
                } catch (error) {
                  console.error('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©:', error);
                }
              }
            }
          }
          
          // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          try {
            await registerUserIfNeeded(telegramUser);
          } catch (error) {
            console.error('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
          }
          
        } else {
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Telegram WebApp Ù…ØªØ§Ø­Ø§Ù‹
          console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
          await useMockData();
        }
        
        await initializeGame();
        
        updateFirebaseStatus('success', 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Telegram WebApp:', error);
        await useMockData();
      }
    }

    async function useMockData() {
      console.log('ğŸ”„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
      
      const mockUser = {
        id: 5922049376,
        first_name: 'Akram',
        last_name: 'Khezzari', 
        username: 'A_mja_d_0_5',
        language_code: 'ar'
      };
      
      currentUser = {
        id: mockUser.id.toString(),
        telegramId: mockUser.id.toString(),
        firstName: mockUser.first_name,
        lastName: mockUser.last_name,
        username: mockUser.username,
        languageCode: mockUser.language_code
      };
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
      document.getElementById('userName').textContent = currentUser.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…';
      document.getElementById('avatarText').textContent = (currentUser.firstName || 'Ù…').charAt(0);
      document.getElementById('userUsername').textContent = currentUser.username ? `@${currentUser.username}` : '';
      document.getElementById('userUsername').style.display = currentUser.username ? 'block' : 'none';
      
      if (db) {
        try {
          await registerUserIfNeeded(mockUser);
        } catch (error) {
          console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ:', error);
        }
      }
      
      await initializeGame();
    }

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ==========
    async function initializeGame() {
      try {
        console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©...');
        
        const loaded = await loadUserData();
        if (!loaded) {
          throw new Error("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©");
        }
        
        updateUserInfo();
        renderCheckinCalendar();
        renderDailyTasks();
        renderAchievements();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        setTimeout(async () => {
          await loadAdditionalData();
        }, 500);
        
        setupEventListeners();
        checkDailyCheckin();
        hideAllNewSections();
        
        setTimeout(() => {
          showMessage(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${gameData.user.name}! Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ù„Ø¹Ø¨Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠØ©`);
        }, 1000);
        
        console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­');
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©:', error);
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
      }
    }

    // ========== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Crynova...');
      
      if (!firebaseApp) {
        document.getElementById('userName').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
        console.error('Firebase not initialized');
        return;
      }
      
      // Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ Ù…Ø¤Ø´Ø±Ø§Øª ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠØ©
      setTimeout(() => {
        const quickLoaders = document.querySelectorAll('.quick-load');
        quickLoaders.forEach(loader => {
          loader.style.display = 'none';
        });
      }, 1000);
      
      // Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹ Ø¨ÙˆØª Telegram
      initializeWithTelegramBot();
    });
  </script>
</body>
</html>
